<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill tracker</title>
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/components.css">
</head>
<body>

    <div class="container">

        <h1>Skill Tracker</h1>

        <div class="form-row">
            <input id="skillNameInput" class="input" placeholder="Название навыка">

            <select id="categorySelect" class="input">
                <option value="backend">Backend</option>
                <option value="frontend">Frontend</option>
                <option value="tools">Tools</option>
            </select>

            <button id="addSkillBtn" class="btn">Добавить</button>
        </div>

        <div id="skillsList"></div>
        
    <!--
        
        <section class="section">
            <h2 class="section-title">Общий прогресс</h2>

            <progress value="30" max="100"></progress>
            <span>30%</span>
        </section>

        
        <section class="section">
            <h2 class="section-title">Backend</h2>

            <div class="skill-grid">
                
                <div class="skill">
                    <div class="skill-header">
                        <span>FastAPI</span>
                        <progress value="40" max="100"></progress>
                        <span>40%</span>
                    </div>

                    <ul class="subskills">
                        <li><input type="checkbox"> Routing</li>
                        <li><input type="checkbox"> Pydantic</li>
                        <li><input type="checkbox"> Services</li>
                    </ul>
                </div>
            </div>
        </section>

        
        <section class="section">
            <h2 class="section-title">Frontend</h2>

            <div class="skill-grid">
                <div class="skill">
                    <div class="skill-header">
                        <span>HTML / CSS</span>
                        <progress value="20" max="100"></progress>
                        <span>20%</span>
                    </div>
                </div>
            </div>
        </section>
    -->

    </div>

    <script>
    const skillsList = document.getElementById("skillsList");
    const nameInput = document.getElementById("skillNameInput");
    const categorySelect = document.getElementById("categorySelect");
    const addButton = document.getElementById("addSkillBtn");

    function loadSkills() {
      fetch("/api/skills")
        .then(response => response.json())
        .then(skills => {
          skillsList.innerHTML = "";

          skills.forEach(skill => {
            const skillEl = document.createElement("div");
            skillEl.className = "skill";

            skillEl.innerHTML = `
              <div class="skill-header">
                <span>${skill.name}</span>
                <span>0%</span>
              </div>

              <progress value="0" max="100"></progress>

              <button class="btn btn-danger">
                Удалить
              </button>
            `;

            const deleteBtn = skillEl.querySelector(".btn-danger");
            deleteBtn.addEventListener("click", () => {
              deleteSkill(skill.id);
            });

            skillsList.appendChild(skillEl);
          });
        });
    }

    function addSkill() {
      const name = nameInput.value.trim();
      const category = categorySelect.value;

      if (!name) return;

      fetch("http://127.0.0.1:8000/skills", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name: name,
          category: category
        })
      })
      .then(response => {
        if (!response.ok) {
          alert("Навык уже существует");
          return;
        }
        nameInput.value = "";
        loadSkills();
      });
    }

    function deleteSkill(id) {
      fetch(`http://127.0.0.1:8000/skills/${id}`, {
        method: "DELETE"
      })
      .then(() => {
        loadSkills();
      });
    }

    addButton.addEventListener("click", addSkill);

    loadSkills();
  </script>
</body>
</html>